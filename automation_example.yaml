# PÃ©lda automatizÃ¡lÃ¡s a sorsolÃ¡s Ã©rtesÃ­tÃ©shez
# MÃ¡sold be ezt a kÃ³dot az automations.yaml fÃ¡jlodba
# vagy hozz lÃ©tre egy Ãºj automatizÃ¡lÃ¡st a felÃ¼leten YAML mÃ³dban.

alias: "OTP GÃ©pkocsinyeremÃ©ny - Ã‰rtesÃ­tÃ©s sorsolÃ¡srÃ³l"
description: "Ã‰rtesÃ­tÃ©st kÃ¼ld a telefonra, ha ma tÃ¶rtÃ©nt sorsolÃ¡s."
trigger:
  - platform: state
    entity_id: user_input_entity_id_placeholder # CSERÃ‰LD KI: sensor.otp_betetek
    attribute: utolso_sorsolas
condition:
  - condition: template
    value_template: >-
      {% set months = {
        1: "januÃ¡r", 2: "februÃ¡r", 3: "mÃ¡rcius", 4: "Ã¡prilis",
        5: "mÃ¡jus", 6: "jÃºnius", 7: "jÃºlius", 8: "augusztus",
        9: "szeptember", 10: "oktÃ³ber", 11: "november", 12: "december"
      } %}
      {% set today_str = now().year ~ ". " ~ months[now().month] ~ " " ~ now().day ~ "." %}
      {{ state_attr('trigger.entity_id', 'utolso_sorsolas') == today_str }}
action:
  - service: notify.mobile_app_sajÃ¡t_telefon # CSERÃ‰LD KI a sajÃ¡t eszkÃ¶zÃ¶dre
    data:
      title: "ğŸš— OTP GÃ©pkocsinyeremÃ©ny SorsolÃ¡s!"
      message: >-
        Ma volt a sorsolÃ¡s! ({{ state_attr('trigger.entity_id', 'utolso_sorsolas') }})
        
        {% set count = states('sensor.otp_betetek')|int(0) %}
        {% if count > 0 %}
          ğŸ‰ GRATULÃLOK! {{ count }} db nyeremÃ©nyed van!
        {% else %}
          Sajnos most nem nyertÃ©l.
        {% endif %}
      data:
        url: /lovelace/otp # Vagy ahol a kÃ¡rtyÃ¡d van
