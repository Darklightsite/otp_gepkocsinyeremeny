# üõãÔ∏è OTP G√©pkocsinyerem√©ny - Komfort K√°rtya
# ‚ö†Ô∏è Cser√©ld le az entit√°s neveket ha m√°s nevet adt√°l az integr√°ci√≥nak!

type: custom:stack-in-card
mode: vertical
keep:
  background: false
  box_shadow: false
  margin: false
  outer_padding: false
  border_radius: false
card_mod:
  style: |
    ha-card {
      border: 1px solid var(--divider-color) !important;
      border-radius: 12px !important;
      padding: 16px !important;
      background: var(--card-background-color);
    }
cards:
  # Header - Letisztult
  - type: custom:mushroom-template-card
    primary: "OTP G√©pkocsinyerem√©ny"
    secondary: >-
      {% set count = states('sensor.otp_betetek')|int(0) %}
      {% if count > 0 %}
        {{ count }} db nyerem√©nyed van!
      {% else %}
        {{ state_attr('sensor.otp_betetek', 'figyelt_db') | default(0) }} bet√©tet figyel√ºnk
      {% endif %}
    icon: mdi:bank
    icon_color: green
    layout: horizontal
    tap_action:
      action: more-info
      entity: sensor.otp_betetek
    card_mod:
      style: |
        ha-card {
          margin-bottom: 12px !important;
        }

  # Chips - Egyszer≈±, sz√ºrke ikonok
  - type: custom:mushroom-chips-card
    chips:
      - type: template
        icon: mdi:ticket-outline
        content: "{{ state_attr('sensor.otp_betetek', 'figyelt_db') | default(0) }} db"
      - type: template
        icon: mdi:calendar-check
        content: "Utols√≥: {{ state_attr('sensor.otp_betetek', 'utolso_sorsolas') | default('?') }}"
      - type: template
        icon: mdi:calendar-arrow-right
        content: "K√∂vetkez≈ë: {{ state_attr('sensor.otp_betetek', 'kovetkezo_sorsolas') | default('?') }}"
    alignment: start
    card_mod:
      style: |
        ha-card {
          --chip-background: var(--secondary-background-color);
          --chip-spacing: 8px;
        }

  # Winner Section - Kiemelt de nem villog√≥
  - type: conditional
    conditions:
      - entity: sensor.otp_betetek
        state_not: "0"
    card:
      type: markdown
      content: >-
        ### üèÜ Gratul√°lunk, nyert√©l!
        
        {% set items = state_attr('sensor.otp_betetek', 'nyertes_reszletek') %}
        {% if items %}
          {% for item in items %}
          **{{ item.szam }}**
          _{{ item.auto }}_
          {% endfor %}
        {% endif %}
      card_mod:
        style: |
          ha-card {
            background: rgba(var(--rgb-success-color), 0.1) !important;
            border-left: 4px solid var(--success-color) !important;
            border-radius: 4px !important;
            padding: 12px !important;
            margin-top: 16px !important;
            margin-bottom: 16px !important;
            box-shadow: none !important;
          }
          ha-markdown {
            padding: 0 !important;
          }
          h3 {
            margin-top: 0;
            color: var(--success-color);
          }

  # History Section - Egyszer≈± lista
  - type: markdown
    content: >-
      **Kor√°bbi nyerem√©nyek:**
      
  # History Section - Egyszer≈± lista
  - type: markdown
    content: >-
      **Kor√°bbi nyerem√©nyek:**<br><br>
      {%- set history = state_attr('sensor.otp_betetek', 'nyeremeny_tortenelem') -%}
      {%- set last_draw = state_attr('sensor.otp_betetek', 'utolso_sorsolas') -%}
      {%- if history -%}
        {%- set ns = namespace(last_date=None, printed_any=false) -%}
        {%- for item in history -%}
          {%- if item.datum != last_draw -%}
            {%- set ns.printed_any = true -%}
            {%- if ns.last_date != item.datum -%}
              {%- if ns.last_date is not none -%}<br>{%- endif -%}
              **{{ item.datum }}**: 
              {%- set ns.last_date = item.datum -%}
            {%- else -%}
              , 
            {%- endif -%}
            {{ item.szam }}{%- if item.auto -%} (_{{ item.auto }}_){%- endif -%}
          {%- endif -%}
        {%- endfor -%}
        {%- if not ns.printed_any -%}
          Nincs megjelen√≠thet≈ë adat.
        {%- endif -%}
      {%- else -%}
        Nincs kor√°bbi nyerem√©ny.
      {%- endif -%}
    card_mod:
      style: |
        ha-card {
          border: none !important;
          box-shadow: none !important;
          background: none !important;
          padding: 0px !important;
          margin-top: 8px !important;
          font-size: 14px;
        }
        p {
          margin: 0 !important;
          line-height: 1.6;
        }

  # Footer - Update Status
  - type: custom:mushroom-template-card
    primary: "Friss√≠tve: {{ state_attr('sensor.otp_betetek', 'adatbazis_frissitve') | default('Ismeretlen') }}"
    secondary: "√Ållapot: {{ state_attr('sensor.otp_betetek', 'frissites_allapota') | default('Ismeretlen') }}"
    icon: mdi:database-refresh
    icon_color: grey
    layout: horizontal
    tap_action:
      action: none
    card_mod:
      style: |
        ha-card {
          margin-top: 5px !important;
          background: none !important;
          border: none !important;
          box-shadow: none !important;
        }
        :host {
          --primary-text-color: #888;
          --secondary-text-color: #666;
          --icon-size: 20px;
        }
