# üöó OTP G√©pkocsinyerem√©ny - Premium K√°rtya
# ‚ö†Ô∏è Cser√©ld le az entit√°s neveket ha m√°s nevet adt√°l az integr√°ci√≥nak!

type: custom:stack-in-card
mode: vertical
keep:
  background: false
  box_shadow: false
  margin: false
  outer_padding: false
  border_radius: false
card_mod:
  style: |
    ha-card {
      border: 1px solid var(--divider-color) !important;
      border-radius: 12px !important;
      padding: 10px !important;
    }
cards:
  # Header
  - type: custom:mushroom-template-card
    primary: "üöó OTP G√©pkocsinyerem√©ny"
    secondary: >-
      {% set count = states('sensor.otp_betetek')|int(0) %}
      {% if count > 0 %}
        üéâ {{ count }} db nyerem√©ny!
      {% else %}
        {{ state_attr('sensor.otp_betetek', 'figyelt_db') | default(0) }} bet√©t figyelve
      {% endif %}
    icon: >-
      {% if states('sensor.otp_betetek')|int(0) > 0 %}mdi:trophy{% else %}mdi:car-convertible{% endif %}
    icon_color: >-
      {% if states('sensor.otp_betetek')|int(0) > 0 %}amber{% else %}blue{% endif %}
    layout: horizontal
    tap_action:
      action: more-info
      entity: sensor.otp_betetek

  # Chips (Stats)
  - type: custom:mushroom-chips-card
    chips:
      - type: template
        icon: mdi:ticket-outline
        icon_color: cyan
        content: "{{ state_attr('sensor.otp_betetek', 'figyelt_db') | default(0) }} db"
      - type: template
        icon: mdi:calendar-check
        icon_color: green
        content: "{{ state_attr('sensor.otp_betetek', 'utolso_sorsolas') | default('?') }}"
      - type: template
        icon: mdi:calendar-clock
        icon_color: orange
        content: "{{ state_attr('sensor.otp_betetek', 'kovetkezo_sorsolas') | default('?') }}"
      - type: entity
        entity: button.otp_betetek_adatbazis_frissitese
        icon_color: blue
        tap_action:
          action: toggle
        content_info: none
    alignment: center

  # Winner Section (Only visible if won)
  - type: conditional
    conditions:
      - entity: sensor.otp_betetek
        state_not: "0"
    card:
      type: custom:mushroom-template-card
      primary: "üèÜ Nyertes Bet√©tek!"
      secondary: >-
        {% set items = state_attr('sensor.otp_betetek', 'nyertes_reszletek') %}
        {% if items %}
          {% for item in items %}
          üé´ {{ item.szam }}{% if item.auto %} ‚Üí {{ item.auto }}{% endif %}
          {% endfor %}
        {% endif %}
      icon: mdi:party-popper
      icon_color: amber
      layout: vertical
      multiline_secondary: true
      card_mod:
        style: |
          ha-card {
            background: rgba(255, 193, 7, 0.1) !important;
            border: 1px solid rgba(255, 193, 7, 0.3) !important;
            margin-top: 10px !important;
            margin-bottom: 10px !important;
          }

  # History Section
  # History Section
  - type: markdown
    content: >-
      <ha-icon icon="mdi:history" style="color: purple; margin-right: 8px;"></ha-icon><span style="font-weight: 500; font-size: 16px;">Kor√°bbi nyerem√©nyek</span><br><br>
      {%- set history = state_attr('sensor.otp_betetek', 'nyeremeny_tortenelem') -%}
      {%- set last_draw = state_attr('sensor.otp_betetek', 'utolso_sorsolas') -%}
      {%- if history -%}
        {%- set ns = namespace(last_date=None, printed_any=false) -%}
        {%- for item in history -%}
          {%- if item.datum != last_draw -%}
            {%- set ns.printed_any = true -%}
            {%- if ns.last_date != item.datum -%}
              {%- if ns.last_date is not none -%}<br>{%- endif -%}
              **{{ item.datum }}**: 
              {%- set ns.last_date = item.datum -%}
            {%- else -%}
              , 
            {%- endif -%}
            {{ item.szam }} {%- if item.auto -%} (_{{ item.auto }}_){%- endif -%}
          {%- endif -%}
        {%- endfor -%}
        {%- if not ns.printed_any -%}
          Nincs kor√°bbi nyerem√©ny
        {%- endif -%}
      {%- else -%}
        Nincs kor√°bbi nyerem√©ny
      {%- endif -%}
    card_mod:
      style: |
        ha-card {
          border: none !important;
          box-shadow: none !important;
          background: none !important;
          padding: 16px !important;
          padding-top: 0px !important;
          max-height: 300px;
          overflow-y: auto;
        }
        ha-markdown {
          padding: 0 !important;
        }
        p {
          margin: 0 !important;
          line-height: 1.6;
        }

  # Footer - Update Status
  - type: custom:mushroom-template-card
    primary: "Friss√≠tve: {{ state_attr('sensor.otp_betetek', 'adatbazis_frissitve') | default('Ismeretlen') }}"
    secondary: "√Ållapot: {{ state_attr('sensor.otp_betetek', 'frissites_allapota') | default('Ismeretlen') }}"
    icon: mdi:database-refresh
    icon_color: grey
    layout: horizontal
    tap_action:
      action: none
    card_mod:
      style: |
        ha-card {
          margin-top: 5px !important;
          background: none !important;
          border: none !important;
          box-shadow: none !important;
        }
        :host {
          --primary-text-color: #888;
          --secondary-text-color: #666;
          --icon-size: 24px;
        }
