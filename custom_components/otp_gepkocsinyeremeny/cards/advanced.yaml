# üöó OTP G√©pkocsinyerem√©ny - Premium K√°rtya
# 
# ‚ö†Ô∏è HASZN√ÅLAT: A k√°rtya bem√°sol√°sa ut√°n az entit√°s neveket cser√©ld le!
# Menj a Fejleszt≈ëi Eszk√∂z√∂k > √Ållapotok men√ºbe hogy megl√°sd a pontos entit√°s neveket.
# P√©ld√°k: sensor.csaladi_betetek, sensor.nagymama_betetei stb.

type: vertical-stack
cards:
  # --- FEJL√âC ---
  - type: custom:mushroom-template-card
    primary: "üöó OTP G√©pkocsinyerem√©ny"
    secondary: >-
      {% set count = states('sensor.otp_betetek')|int(0) %}
      {% if count > 0 %}
        üéâ {{ count }} db nyerem√©ny!
      {% else %}
        {{ state_attr('sensor.otp_betetek', 'figyelt_db')|default(0) }} bet√©t figyelve
      {% endif %}
    icon: >-
      {% if states('sensor.otp_betetek')|int(0) > 0 %}
        mdi:trophy
      {% else %}
        mdi:car-convertible
      {% endif %}
    icon_color: >-
      {% if states('sensor.otp_betetek')|int(0) > 0 %}amber{% else %}blue{% endif %}
    fill_container: true
    layout: horizontal
    tap_action:
      action: more-info
      entity: sensor.otp_betetek
    card_mod:
      style: |
        ha-card {
          background: linear-gradient(135deg, 
            rgba(30, 35, 45, 0.95) 0%, 
            rgba(45, 55, 70, 0.9) 100%);
          border: 1px solid rgba(255, 193, 7, 0.3);
          border-radius: 16px;
          backdrop-filter: blur(10px);
          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        mushroom-shape-icon {
          --shape-color: {% if states('sensor.otp_betetek')|int(0) > 0 %}
            rgba(255, 193, 7, 0.2){% else %}rgba(66, 165, 245, 0.2){% endif %} !important;
        }

  # --- INFO CHIPEK ---
  - type: custom:mushroom-chips-card
    chips:
      # Bet√©tek sz√°ma
      - type: template
        icon: mdi:ticket-outline
        icon_color: cyan
        content: "{{ state_attr('sensor.otp_betetek', 'figyelt_db')|default(0) }} db"
        tap_action:
          action: more-info
          entity: sensor.otp_betetek
      
      # Utols√≥ sorsol√°s
      - type: template
        icon: mdi:calendar-check
        icon_color: green
        content: >-
          {{ state_attr('sensor.otp_betetek', 'utolso_sorsolas')|default('?') }}
        tap_action:
          action: none

      # K√∂vetkez≈ë sorsol√°s
      - type: template
        icon: mdi:calendar-clock
        icon_color: orange
        content: >-
          {{ state_attr('sensor.otp_betetek', 'kovetkezo_sorsolas')|default('?') }}
        tap_action:
          action: none

      # Friss√≠t√©s gomb
      - type: entity
        entity: button.otp_betetek_adatbazis_frissitese
        icon_color: blue
        tap_action:
          action: toggle
        content_info: none
        
    alignment: center
    card_mod:
      style: |
        ha-card {
          background: transparent;
          border: none;
          margin-top: -8px;
        }

  # --- NYEREM√âNYEK (CSAK HA VAN) ---
  - type: conditional
    conditions:
      - entity: sensor.otp_betetek
        state_not: "0"
    card:
      type: custom:mushroom-template-card
      primary: "üèÜ Nyertes Bet√©tek!"
      secondary: >-
        {% for item in state_attr('sensor.otp_betetek', 'nyertes_reszletek')|default([]) %}
        üé´ {{ item.szam }}{% if item.auto %} ‚Üí {{ item.auto }}{% endif %}
        {% endfor %}
      icon: mdi:party-popper
      icon_color: amber
      layout: vertical
      multiline_secondary: true
      card_mod:
        style: |
          ha-card {
            background: linear-gradient(135deg, 
              rgba(255, 193, 7, 0.15) 0%, 
              rgba(255, 152, 0, 0.1) 100%);
            border: 1px solid rgba(255, 193, 7, 0.4);
            border-radius: 12px;
            margin: 8px 0;
            animation: pulse 2s infinite;
          }
          @keyframes pulse {
            0%, 100% { box-shadow: 0 0 5px rgba(255, 193, 7, 0.3); }
            50% { box-shadow: 0 0 20px rgba(255, 193, 7, 0.6); }
          }

  # --- EL≈êZM√âNYEK ---
  - type: conditional
    conditions:
      - entity: sensor.otp_betetek
        attribute: nyeremeny_tortenelem
        state_not: "[]"
    card:
      type: custom:mushroom-template-card
      primary: "üìú Kor√°bbi nyerem√©nyek"
      secondary: >-
        {% set history = state_attr('sensor.otp_betetek', 'nyeremeny_tortenelem')|default([]) %}
        {% for item in history[:3] %}
        {{ item.datum }}: {{ item.szam }}
        {% endfor %}
        {% if history|length > 3 %}...√©s m√©g {{ history|length - 3 }} db{% endif %}
      icon: mdi:history
      icon_color: purple
      layout: vertical
      multiline_secondary: true
      tap_action:
        action: more-info
        entity: sensor.otp_betetek
      card_mod:
        style: |
          ha-card {
            background: rgba(156, 39, 176, 0.1);
            border: 1px solid rgba(156, 39, 176, 0.3);
            border-radius: 12px;
            margin-top: 8px;
          }
